# OpenCode

OpenCode is an open-source AI coding agent that provides a terminal-based interface for AI-assisted software development. It supports 75+ LLM providers through the AI SDK and Models.dev, works with local models, and offers a client/server architecture allowing programmatic control. The project features built-in agents (Build for full development, Plan for read-only analysis), MCP (Model Context Protocol) server support for extending tool capabilities, LSP integration, and a comprehensive configuration system supporting JSON/JSONC formats.

The core functionality centers around session-based AI interactions where users can send prompts, execute commands, and have the AI perform file operations, run shell commands, and search codebases. OpenCode can run as a TUI (Terminal User Interface), headless server, web interface, or be controlled programmatically via the TypeScript SDK. Key features include structured JSON output, session sharing, file watching, automatic context compaction, and customizable keybinds and themes.

## Installation

Install OpenCode using various package managers or the install script.

```bash
# Quick install
curl -fsSL https://opencode.ai/install | bash

# npm/pnpm/bun/yarn
npm i -g opencode-ai@latest

# Homebrew (macOS/Linux)
brew install anomalyco/tap/opencode

# Scoop/Chocolatey (Windows)
scoop install opencode
choco install opencode

# Arch Linux
sudo pacman -S opencode

# Nix
nix run nixpkgs#opencode
```

## CLI Commands

Run OpenCode in various modes from the command line.

The CLI provides commands for TUI mode, non-interactive prompts, server operation, and session management.

```bash
# Start TUI (default)
opencode

# Continue last session
opencode --continue

# Non-interactive mode with prompt
opencode run "Explain how closures work in JavaScript"

# Attach file to prompt
opencode run -f src/index.ts "Review this file for security issues"

# Start headless server
opencode serve --port 4096 --hostname 0.0.0.0

# Start web interface
opencode web --port 4096

# Attach TUI to running server
opencode attach http://localhost:4096

# List sessions
opencode session list --format json

# Export session
opencode export <sessionID>

# Show usage stats
opencode stats --days 30 --models 10

# List available models
opencode models anthropic

# Manage authentication
opencode auth login
opencode auth list
opencode auth logout
```

## SDK Installation and Setup

Install the TypeScript SDK to interact with OpenCode programmatically.

The SDK provides a type-safe client for the OpenCode server API, supporting all server endpoints with full TypeScript definitions.

```typescript
import { createOpencode, createOpencodeClient, createOpencodeServer } from "@opencode-ai/sdk"
import type { Session, Message, Part } from "@opencode-ai/sdk"

// Create server and client together
const { client, server } = await createOpencode({
  hostname: "127.0.0.1",
  port: 4096,
  timeout: 5000,
  config: {
    model: "anthropic/claude-sonnet-4-5",
  },
})

console.log(`Server running at ${server.url}`)

// Client-only (connect to existing server)
const clientOnly = createOpencodeClient({
  baseUrl: "http://localhost:4096",
  throwOnError: true,
})

// Server-only
const serverOnly = await createOpencodeServer({
  hostname: "127.0.0.1",
  port: 4096,
  signal: abortController.signal,
})

// Cleanup
server.close()
```

## Session Management

Create and manage AI conversation sessions.

Sessions are the primary unit of interaction, containing messages, context, and state for AI conversations.

```typescript
import { createOpencodeClient } from "@opencode-ai/sdk"

const client = createOpencodeClient({ baseUrl: "http://localhost:4096" })

// Create a new session
const session = await client.session.create({
  body: { title: "Feature implementation" },
})
console.log("Session ID:", session.data.id)

// List all sessions
const sessions = await client.session.list()
sessions.data.forEach((s) => console.log(s.id, s.title))

// Get session details
const details = await client.session.get({
  path: { id: session.data.id },
})

// Update session title
await client.session.update({
  path: { id: session.data.id },
  body: { title: "Updated title" },
})

// Fork session at specific message
const forked = await client.session.fork({
  path: { id: session.data.id },
  body: { messageID: "msg_123" },
})

// Share/unshare session
await client.session.share({ path: { id: session.data.id } })
await client.session.unshare({ path: { id: session.data.id } })

// Abort running session
await client.session.abort({ path: { id: session.data.id } })

// Delete session
await client.session.delete({ path: { id: session.data.id } })
```

## Sending Prompts

Send messages to the AI and receive responses.

The prompt API supports text messages, file attachments, model selection, and structured output formats.

```typescript
import { createOpencodeClient } from "@opencode-ai/sdk"

const client = createOpencodeClient({ baseUrl: "http://localhost:4096" })

// Basic prompt
const result = await client.session.prompt({
  path: { id: sessionId },
  body: {
    parts: [{ type: "text", text: "Explain async/await in JavaScript" }],
  },
})
console.log("Response:", result.data.parts)

// Prompt with specific model
const response = await client.session.prompt({
  path: { id: sessionId },
  body: {
    model: { providerID: "anthropic", modelID: "claude-sonnet-4-5" },
    parts: [{ type: "text", text: "Write a function to parse JSON safely" }],
  },
})

// Inject context without triggering AI response
await client.session.prompt({
  path: { id: sessionId },
  body: {
    noReply: true,
    parts: [{ type: "text", text: "You are a helpful coding assistant." }],
  },
})

// Async prompt (returns immediately)
await client.session.promptAsync({
  path: { id: sessionId },
  body: {
    parts: [{ type: "text", text: "Refactor this codebase" }],
  },
})

// Execute slash command
const cmdResult = await client.session.command({
  path: { id: sessionId },
  body: {
    command: "test",
    arguments: "src/**/*.test.ts",
  },
})

// Run shell command
const shellResult = await client.session.shell({
  path: { id: sessionId },
  body: {
    agent: "build",
    command: "npm test",
  },
})
```

## Structured Output

Request validated JSON responses matching a schema.

Structured output uses JSON Schema to ensure the model returns data in a specific format with automatic validation and retries.

```typescript
import { createOpencodeClient } from "@opencode-ai/sdk"

const client = createOpencodeClient({ baseUrl: "http://localhost:4096" })

const result = await client.session.prompt({
  path: { id: sessionId },
  body: {
    parts: [{ type: "text", text: "Research Anthropic and provide company info" }],
    format: {
      type: "json_schema",
      schema: {
        type: "object",
        properties: {
          company: { type: "string", description: "Company name" },
          founded: { type: "number", description: "Year founded" },
          products: {
            type: "array",
            items: { type: "string" },
            description: "Main products",
          },
          headquarters: { type: "string", description: "HQ location" },
        },
        required: ["company", "founded", "products"],
      },
      retryCount: 3,
    },
  },
})

// Access structured output
const output = result.data.info.structured_output
console.log(output) // { company: "Anthropic", founded: 2021, products: ["Claude"] }

// Handle structured output errors
if (result.data.info.error?.name === "StructuredOutputError") {
  console.error("Failed:", result.data.info.error.message)
  console.error("Attempts:", result.data.info.error.retries)
}
```

## File Operations

Search, read, and list files in the project.

The file API provides fuzzy search, text search with regex, symbol lookup, and file content reading.

```typescript
import { createOpencodeClient } from "@opencode-ai/sdk"

const client = createOpencodeClient({ baseUrl: "http://localhost:4096" })

// Find files by name (fuzzy match)
const files = await client.find.files({
  query: { query: "*.ts", type: "file", limit: 50 },
})
console.log("TypeScript files:", files.data)

// Find directories
const dirs = await client.find.files({
  query: { query: "components", type: "directory" },
})

// Search text in files (regex)
const matches = await client.find.text({
  query: { pattern: "function.*async" },
})
matches.data.forEach((m) => {
  console.log(`${m.path}:${m.line_number}: ${m.lines}`)
})

// Find workspace symbols (functions, classes, etc.)
const symbols = await client.find.symbols({
  query: { query: "handleRequest" },
})

// Read file content
const content = await client.file.read({
  query: { path: "src/index.ts" },
})
console.log(content.data.content)

// List directory contents
const listing = await client.file.list({
  query: { path: "src/components" },
})

// Get file status (git status)
const status = await client.file.status()
status.data.forEach((f) => console.log(f.path, f.status))
```

## Event Subscription

Subscribe to real-time server events via SSE.

Events stream provides live updates for session state, messages, tool executions, and system notifications.

```typescript
import { createOpencodeClient } from "@opencode-ai/sdk"

const client = createOpencodeClient({ baseUrl: "http://localhost:4096" })

// Subscribe to all events
const events = await client.event.subscribe()

for await (const event of events.stream) {
  console.log("Event type:", event.type)
  console.log("Properties:", event.properties)

  // Handle specific event types
  switch (event.type) {
    case "session.created":
      console.log("New session:", event.properties.sessionId)
      break
    case "message.created":
      console.log("New message:", event.properties.messageId)
      break
    case "tool.started":
      console.log("Tool running:", event.properties.toolName)
      break
    case "tool.completed":
      console.log("Tool finished:", event.properties.result)
      break
  }
}

// Global events (health, version)
const globalEvents = await client.global.event()
```

## Configuration File

Configure OpenCode using JSON or JSONC files.

Configuration supports models, providers, themes, tools, agents, MCP servers, permissions, and custom commands.

```jsonc
// opencode.json or opencode.jsonc
{
  "$schema": "https://opencode.ai/config.json",

  // Model configuration
  "model": "anthropic/claude-sonnet-4-5",
  "small_model": "anthropic/claude-haiku-4-5",

  // Provider settings
  "provider": {
    "anthropic": {
      "options": {
        "timeout": 600000,
        "baseURL": "https://api.anthropic.com/v1"
      }
    },
    "amazon-bedrock": {
      "options": {
        "region": "us-east-1",
        "profile": "my-aws-profile"
      }
    }
  },

  // Tool access
  "tools": {
    "write": true,
    "bash": true,
    "edit": true
  },

  // Permission settings
  "permission": {
    "edit": "ask",
    "bash": "ask",
    "webfetch": "allow"
  },

  // Theme
  "theme": "opencode",

  // TUI settings
  "tui": {
    "scroll_speed": 3,
    "diff_style": "auto"
  },

  // Server settings
  "server": {
    "port": 4096,
    "hostname": "0.0.0.0",
    "mdns": true,
    "cors": ["http://localhost:5173"]
  },

  // Auto-update
  "autoupdate": true,

  // Sharing mode: "manual", "auto", or "disabled"
  "share": "manual",

  // Custom instructions files
  "instructions": ["CONTRIBUTING.md", "docs/guidelines.md"],

  // Disable specific providers
  "disabled_providers": ["openai"],

  // Enable only specific providers
  "enabled_providers": ["anthropic", "opencode"]
}
```

## Custom Agents

Create specialized agents with custom prompts and tool access.

Agents can be primary (main interaction) or subagents (invoked via @mention or automatically by primary agents).

```jsonc
// opencode.json
{
  "$schema": "https://opencode.ai/config.json",
  "agent": {
    "code-reviewer": {
      "description": "Reviews code for best practices and security issues",
      "mode": "subagent",
      "model": "anthropic/claude-sonnet-4-5",
      "temperature": 0.1,
      "prompt": "You are a code reviewer. Focus on security, performance, and maintainability.",
      "tools": {
        "write": false,
        "edit": false,
        "bash": false
      },
      "permission": {
        "edit": "deny"
      }
    },
    "docs-writer": {
      "description": "Writes and maintains documentation",
      "mode": "subagent",
      "tools": {
        "bash": false
      }
    },
    "quick-thinker": {
      "description": "Fast reasoning with limited iterations",
      "steps": 5, // Max agentic iterations
      "temperature": 0.3
    }
  },
  "default_agent": "build"
}
```

```markdown
<!-- ~/.config/opencode/agents/security-auditor.md -->
---
description: Performs security audits and identifies vulnerabilities
mode: subagent
model: anthropic/claude-sonnet-4-5
temperature: 0.1
tools:
  write: false
  edit: false
permission:
  bash:
    "*": ask
    "grep *": allow
---

You are a security expert. Focus on identifying potential security issues.

Look for:
- Input validation vulnerabilities
- Authentication and authorization flaws
- Data exposure risks
- Dependency vulnerabilities
```

## MCP Server Configuration

Add external tools via Model Context Protocol servers.

MCP servers extend OpenCode with custom tools that the AI can invoke alongside built-in tools.

```jsonc
// opencode.json
{
  "$schema": "https://opencode.ai/config.json",
  "mcp": {
    // Local MCP server
    "mcp_everything": {
      "type": "local",
      "command": ["npx", "-y", "@modelcontextprotocol/server-everything"],
      "enabled": true,
      "environment": {
        "DEBUG": "true"
      },
      "timeout": 10000
    },

    // Remote MCP server
    "context7": {
      "type": "remote",
      "url": "https://mcp.context7.com/mcp",
      "enabled": true,
      "headers": {
        "CONTEXT7_API_KEY": "{env:CONTEXT7_API_KEY}"
      }
    },

    // OAuth-enabled remote server
    "sentry": {
      "type": "remote",
      "url": "https://mcp.sentry.dev/mcp",
      "oauth": {}
    },

    // Pre-registered OAuth credentials
    "my-server": {
      "type": "remote",
      "url": "https://mcp.example.com/mcp",
      "oauth": {
        "clientId": "{env:MCP_CLIENT_ID}",
        "clientSecret": "{env:MCP_CLIENT_SECRET}",
        "scope": "tools:read tools:execute"
      }
    }
  },

  // Disable MCP tools globally
  "tools": {
    "sentry_*": false
  },

  // Enable MCP tools per agent
  "agent": {
    "debug": {
      "tools": {
        "sentry_*": true
      }
    }
  }
}
```

```bash
# Manage MCP authentication
opencode mcp list
opencode mcp auth sentry
opencode mcp logout sentry
opencode mcp debug sentry
```

## Custom Commands

Define reusable prompt templates as slash commands.

Commands provide shortcuts for common tasks with variable substitution and agent/model overrides.

```jsonc
// opencode.json
{
  "$schema": "https://opencode.ai/config.json",
  "command": {
    "test": {
      "template": "Run the full test suite with coverage report and show any failures.\nFocus on the failing tests and suggest fixes.",
      "description": "Run tests with coverage",
      "agent": "build",
      "model": "anthropic/claude-haiku-4-5"
    },
    "component": {
      "template": "Create a new React component named $ARGUMENTS with TypeScript support.\nInclude proper typing, tests, and documentation.",
      "description": "Create a new React component"
    },
    "review": {
      "template": "Review the following code for security issues, performance problems, and best practices:\n$ARGUMENTS",
      "description": "Code review",
      "agent": "plan"
    },
    "doc": {
      "template": "Generate comprehensive documentation for $ARGUMENTS including:\n- API reference\n- Usage examples\n- Common patterns",
      "description": "Generate documentation"
    }
  }
}
```

```markdown
<!-- .opencode/commands/deploy.md -->
---
description: Deploy to production with safety checks
agent: build
---

Before deploying to production:
1. Run all tests
2. Check for uncommitted changes
3. Verify environment variables
4. Deploy using: $ARGUMENTS

Report any issues encountered.
```

## Provider Authentication

Configure LLM provider credentials and settings.

OpenCode supports 75+ providers including Anthropic, OpenAI, Google, Amazon Bedrock, and local models.

```bash
# Interactive login
opencode auth login

# List authenticated providers
opencode auth list

# Logout from provider
opencode auth logout
```

```typescript
import { createOpencodeClient } from "@opencode-ai/sdk"

const client = createOpencodeClient({ baseUrl: "http://localhost:4096" })

// Set API key programmatically
await client.auth.set({
  path: { id: "anthropic" },
  body: { type: "api", key: "sk-ant-..." },
})

// List providers
const providers = await client.provider.list()
console.log("Available:", providers.data.all)
console.log("Connected:", providers.data.connected)

// Get auth methods
const authMethods = await client.provider.auth()
```

```jsonc
// opencode.json - Provider configuration
{
  "$schema": "https://opencode.ai/config.json",
  "provider": {
    "anthropic": {
      "options": {
        "apiKey": "{env:ANTHROPIC_API_KEY}",
        "timeout": 600000
      }
    },
    "amazon-bedrock": {
      "options": {
        "region": "us-east-1",
        "profile": "my-aws-profile",
        "endpoint": "https://bedrock-runtime.us-east-1.vpce-xxx.amazonaws.com"
      }
    },
    "openai": {
      "options": {
        "baseURL": "https://api.openai.com/v1"
      }
    }
  }
}
```

## TUI Control API

Control the Terminal User Interface programmatically.

The TUI API enables remote control of the interface, useful for IDE integrations and automation.

```typescript
import { createOpencodeClient } from "@opencode-ai/sdk"

const client = createOpencodeClient({ baseUrl: "http://localhost:4096" })

// Append text to prompt input
await client.tui.appendPrompt({
  body: { text: "Review this function" },
})

// Submit the current prompt
await client.tui.submitPrompt()

// Clear the prompt
await client.tui.clearPrompt()

// Show toast notification
await client.tui.showToast({
  body: {
    title: "Success",
    message: "Operation completed",
    variant: "success", // success, error, warning, info
  },
})

// Open dialogs
await client.tui.openHelp()
await client.tui.openSessions()
await client.tui.openThemes()
await client.tui.openModels()

// Execute TUI command
await client.tui.executeCommand({
  body: { command: "agent_cycle" },
})

// Control queue (for custom frontends)
const request = await client.tui.control.next()
await client.tui.control.response({
  body: { /* response data */ },
})
```

## HTTP Server API

Direct HTTP API endpoints for the OpenCode server.

All SDK methods map to HTTP endpoints that can be called directly with curl or any HTTP client.

```bash
# Start server with authentication
OPENCODE_SERVER_PASSWORD=secret opencode serve --port 4096

# Health check
curl http://localhost:4096/global/health

# List sessions
curl http://localhost:4096/session

# Create session
curl -X POST http://localhost:4096/session \
  -H "Content-Type: application/json" \
  -d '{"title": "My Session"}'

# Send prompt
curl -X POST http://localhost:4096/session/{id}/message \
  -H "Content-Type: application/json" \
  -d '{
    "parts": [{"type": "text", "text": "Hello!"}],
    "model": {"providerID": "anthropic", "modelID": "claude-sonnet-4-5"}
  }'

# Search files
curl "http://localhost:4096/find/file?query=*.ts&type=file&limit=20"

# Search text
curl "http://localhost:4096/find?pattern=function.*async"

# Read file
curl "http://localhost:4096/file/content?path=src/index.ts"

# Get OpenAPI spec
curl http://localhost:4096/doc

# Subscribe to events (SSE)
curl -N http://localhost:4096/event
```

## Environment Variables

Configure OpenCode behavior via environment variables.

Environment variables control features, paths, authentication, and experimental options.

```bash
# Configuration
export OPENCODE_CONFIG=/path/to/custom-config.json
export OPENCODE_CONFIG_DIR=/path/to/config-directory
export OPENCODE_CONFIG_CONTENT='{"model": "anthropic/claude-sonnet-4-5"}'

# Server authentication
export OPENCODE_SERVER_PASSWORD=your-password
export OPENCODE_SERVER_USERNAME=admin

# Feature flags
export OPENCODE_AUTO_SHARE=true
export OPENCODE_DISABLE_AUTOUPDATE=true
export OPENCODE_DISABLE_AUTOCOMPACT=true
export OPENCODE_DISABLE_LSP_DOWNLOAD=true
export OPENCODE_DISABLE_DEFAULT_PLUGINS=true
export OPENCODE_ENABLE_EXPERIMENTAL_MODELS=true
export OPENCODE_CLIENT=my-custom-client

# Provider credentials
export ANTHROPIC_API_KEY=sk-ant-...
export OPENAI_API_KEY=sk-...
export AWS_PROFILE=my-profile
export AWS_REGION=us-east-1

# Experimental features
export OPENCODE_EXPERIMENTAL=true
export OPENCODE_EXPERIMENTAL_LSP_TOOL=true
export OPENCODE_EXPERIMENTAL_BASH_DEFAULT_TIMEOUT_MS=60000
export OPENCODE_EXPERIMENTAL_OUTPUT_TOKEN_MAX=8192

# Run with environment variables
OPENCODE_AUTO_SHARE=true opencode run "Explain this code"
```

OpenCode provides a flexible architecture for AI-assisted development with support for multiple LLM providers, extensive customization options, and both interactive and programmatic interfaces. The combination of the TUI for interactive work, the CLI for scripting, and the SDK for integrations makes it adaptable to various development workflows.

For building integrations, the primary patterns are: (1) using `createOpencode()` to spawn a server and get a connected client, (2) using `createOpencodeClient()` to connect to an existing server, and (3) subscribing to the event stream for real-time updates. The session-based model allows maintaining conversation context across multiple prompts, while structured output enables reliable data extraction from AI responses.
