# System tuning for running many dev servers
# Apply with: sudo sysctl -p scripts/sysctl-dev-tuning.conf
# Or copy to /etc/sysctl.d/99-dev-tuning.conf and reboot

# Expand ephemeral port range (default is 32768-60999 = ~28k ports)
# This gives you ~48k ports for dev servers
net.ipv4.ip_local_port_range = 16384 65535

# Allow reuse of TIME_WAIT sockets for new connections
# Critical for rapid start/stop of dev servers on same ports
net.ipv4.tcp_tw_reuse = 1

# Reduce TIME_WAIT duration (default is 60s)
# Faster port recycling when killing/restarting servers
net.ipv4.tcp_fin_timeout = 15

# Increase socket backlog for high-traffic dev scenarios
net.core.somaxconn = 8192
net.core.netdev_max_backlog = 8192

# Increase max open files system-wide
fs.file-max = 2097152

# Allow more inotify watchers (needed for HMR with many files)
# Default is often 8192, which is too low for large monorepos
fs.inotify.max_user_watches = 524288
fs.inotify.max_user_instances = 1024

# Increase max memory map areas (helps with large node_modules)
vm.max_map_count = 262144
